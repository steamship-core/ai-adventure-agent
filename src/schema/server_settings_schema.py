from schema.server_settings import ServerSettings

GENERAL_OPTIONS = [
    {
        "name": "adventure_public",
        "label": "List in public directory",
        "description": "Check this box to list your adventure in the public directory.",
        "type": "boolean",
        "requiresApproval": True,
        "approvalRequestedField": "adventure_public_requested",
        "requiredText": "To make your adventure public and visible to the community, your account must be approved.",
    },
    ServerSettings.setting_schema("name"),
    ServerSettings.setting_schema("short_description"),
    {
        "name": "adventure_description",
        "label": "Description",
        "description": "A longer description of this adventure. Go into detail!",
        "type": "textarea",
        "default": "",
        "required": True,
        "suggestOutputType": "description",
    },
    {
        "name": "adventure_tags",
        "label": "Tags",
        "description": "A list of short string tags.",
        "type": "tag-list",
        "listof": "text",
    },
    {
        "name": "adventure_image",
        "label": "Image",
        "description": "Select an image to represent this adventure.",
        "type": "image",
        "default": "",
        "required": True,
        "suggestOutputType": "image",
    },
    {
        "name": "adventure_player_singular_noun",
        "label": "Noun for a 'Player'",
        "description": "The singular noun used to refer to the pre-made player options. E.g.: Choose your Player (Adventurer, Hero, etc.)",
        "type": "text",
        "default": "Player",
    },
]

STORY_OPTIONS = [
    {
        "name": "story_general_divider",
        "label": "Storytelling Guidance",
        "description": "These settings will guide how the LLM generates your story.",
        "type": "divider",
    },
    ServerSettings.setting_schema("narrative_voice"),
    ServerSettings.setting_schema("narrative_tone"),
    ServerSettings.setting_schema("adventure_background"),
    ServerSettings.setting_schema("adventure_goal"),
    {
        "name": "quest_divider",
        "label": "Quests",
        "description": "Your adventure consists on a number of quests that the character must go on. You can either hand-create these quests or allow the LLM to generate them for each new player on the fly.",
        "type": "divider",
    },
    ServerSettings.setting_schema("fixed_quest_arc"),
    ServerSettings.setting_schema("quests_per_arc"),
    {
        "name": "problem_divider",
        "label": "Quest Problems",
        "description": "Each time a character goes on a quest, they encounter problems they must solve. These problems are generated by the LLM. The following settings control how the LLM generates these problems.",
        "type": "divider",
    },
    ServerSettings.setting_schema("min_problems_per_quest"),
    ServerSettings.setting_schema("problems_per_quest_scale"),
    ServerSettings.setting_schema("max_additional_problems_per_quest"),
    {
        # TODO: Validate float
        "name": "problem_solution_difficulty",
        "label": "Problem difficulty scale factor",
        "description": """The difficulty scale factor applied to the LLM’s estimation of how likely a user’s solution is to solve the problem.  User’s random number between (0,1) must exceed the modified value to succeed.

Base Values:
- VERY UNLIKELY=0.9
- UNLIKELY = 0.7
- LIKELY = 0.3
- VERY LIKELY = 0.1

Difficulty modified value:
1 - ((1-BASE_VALUE) / problem_solution_difficulty)

Result - Doubling difficulty makes success 1/2 as likely; halving difficulty makes success twice as likely.""",
        "type": "float",
        "default": 2,
        "min": 1,
    },
    {
        "name": "advanced_divider",
        "label": "Large Language Model Settings",
        "description": "These advanced settings control the LLM that generates your story.",
        "type": "divider",
    },
    ServerSettings.setting_schema("default_story_model"),
    ServerSettings.setting_schema("default_story_temperature"),
    ServerSettings.setting_schema("default_story_max_tokens"),
]

CHARACTER_OPTIONS = [
    {
        # Validated
        "name": "characters",
        "label": "Pre-made Characters",
        "description": "Each character you add here will be available to players staring a new game.",
        "type": "list",
        "listof": "object",
        "listSchema": [
            {
                "name": "name",
                "label": "Name",
                "description": "Name of the preset character.",
                "type": "text",
                "suggestOutputType": "name",
            },
            {
                "name": "image",
                "label": "Image",
                "description": "Image of the preset character.",
                "type": "image",
                "suggestOutputType": "image",
            },
            {
                "name": "tagline",
                "label": "Tag Line",
                "description": "A short tagline for your character.",
                "type": "text",
                "suggestOutputType": "tagline",
            },
            {
                "name": "description",
                "label": "Description",
                "description": "Description of the preset character. This influences gameplay.",
                "type": "longtext",
                "suggestOutputType": "description",
            },
            {
                "name": "background",
                "label": "Background",
                "description": "Background of the preset character. This influences gameplay.",
                "type": "longtext",
                "suggestOutputType": "background",
            },
        ],
    },
]


IMAGE_OPTIONS = [
    {
        "type": "divider",
        "name": "profile-divider",
        "label": "Profile Images",
        "description": "Set the theme and prompt for generating player profile images.",
        "previewOutputType": "profile_image",
    },
    ServerSettings.setting_schema("profile_image_theme"),
    ServerSettings.setting_schema("profile_image_prompt"),
    ServerSettings.setting_schema("profile_image_negative_prompt"),
    {
        "type": "divider",
        "name": "item-divider",
        "label": "Item Images",
        "description": "Set the theme and prompt for generating images for items found on quests.",
        "previewOutputType": "item_image",
    },
    ServerSettings.setting_schema("item_image_theme"),
    ServerSettings.setting_schema("item_image_prompt"),
    ServerSettings.setting_schema("item_image_negative_prompt"),
    {
        "type": "divider",
        "name": "camp-divider",
        "label": "Camp Images",
        "description": "Set the theme and prompt for generating images for the camp background.",
        "previewOutputType": "camp_image",
    },
    ServerSettings.setting_schema("camp_image_theme"),
    ServerSettings.setting_schema("camp_image_prompt"),
    ServerSettings.setting_schema("camp_image_negative_prompt"),
    {
        "type": "divider",
        "name": "quest-divider",
        "label": "Quest Images",
        "description": "Set the theme and prompt for generating in-quest images.",
        "previewOutputType": "scene_image",
    },
    ServerSettings.setting_schema("quest_background_theme"),
    ServerSettings.setting_schema("quest_background_image_prompt"),
    ServerSettings.setting_schema("quest_background_image_negative_prompt")
]

VOICE_OPTIONS = [
    ServerSettings.setting_schema("narration_voice")
]

MUSIC_OPTIONS = [
    ServerSettings.setting_schema("scene_music_generation_prompt"),
    ServerSettings.setting_schema("camp_music_generation_prompt"),
    ServerSettings.setting_schema("music_duration"),
]

IMAGE_THEME_OPTIONS = [
    ServerSettings.setting_schema("image_themes")
]

GAME_ENGINE_OPTIONS = [
    {
        "name": "game_engine_version",
        "label": "Version",
        "description": "Game engine version this Adventure should use. Only values of the form `ai-adventure@VERSION` will be saved. Replace VERSION with the desired version.",
        "type": "upgrade-offer",
        "default": "",
    }
]

SCHEMA = [
    {
        "spacer": True,
        "title": "General",
    },
    {
        "title": "General Settings",
        "description": "Settings for your game.",
        "href": "general-settings",
        "settings": GENERAL_OPTIONS,
    },
    {
        "spacer": True,
        "title": "Game",
    },
    {
        "title": "Story",
        "description": "The quests and challenges for your adventure.",
        "href": "story-options",
        "settings": STORY_OPTIONS,
    },
    {
        "title": "Characters",
        "description": "Offer pre-made characters to your game players.",
        "href": "character-options",
        "settings": CHARACTER_OPTIONS,
    },
    {
        "title": "Images",
        "description": "Control the generation of your story's images.",
        "href": "image-options",
        "settings": IMAGE_OPTIONS,
    },
    {
        "title": "Voices",
        "description": "Settings that control your story's voice narration.",
        "href": "voice-options",
        "settings": VOICE_OPTIONS,
    },
    {
        "title": "Music",
        "description": "Settings that control your story's music generation.",
        "href": "music-options",
        "settings": MUSIC_OPTIONS,
    },
    {
        "spacer": True,
        "title": "Advanced",
    },
    {
        "title": "Image Themes",
        "description": "Create stable diffusion themes for image generation.",
        "href": "image-themes",
        "settings": IMAGE_THEME_OPTIONS,
    },
    {
        "title": "Game Engine",
        "description": "The AI Agent hosted on Steamship.com powering the game.",
        "href": "game-engine",
        "settings": GAME_ENGINE_OPTIONS,
    },
    {
        "title": "Import",
        "description": "Import an entire adventure template at once by pasting exported YAML and clicking Save.",
        "href": "import",
    },
    {
        "title": "Export",
        "description": "Save or share your adventure settings by copying this block of YAML code.",
        "href": "export",
    },
]
